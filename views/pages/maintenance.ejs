<% layout("/layouts/boilerplate") %>
<div class="action-page">
  <% include ../partials/profileHeader %>
  <section class="tasks__box">
    <h2 class="tasks__title">Tasks</h2>

    <div class="tasks__task-box">
      <!-- prettier-ignore -->
      <%  if (profile.tasks) { %> 
        <%  for (const task of profile.tasks) { %>
            <% include ../partials/task %> 
        <% } } %>
    </div>
    <div class="tasks__new-task-form">
      <form
        class="hidden"
        action="/home/<%=currentUser.username%>/profiles/<%=profile._id%>/maintenance"
        method="POST"
      >
        <div class="form-row">
          <label for="title">Title</label>
          <input
            type="text"
            id="title"
            name="task[title]"
            placeholder="Task description"
            required
          />
        </div>
        <div class="form-row">
          <label for="interval">Maintenance Interval (hrs): </label>
          <input
            type="number"
            step=".1"
            id="interval"
            name="task[interval]"
            placeholder="e.g 7.5"
            required
          />
        </div>
        <div class="form-row">
          <label for="lastDoneAt">Last completed at (hrs): </label>
          <input
            type="number"
            step=".1"
            id="lastDoneAt"
            name="task[lastCompletedAt]"
            placeholder="e.g. 7.5"
            required
          />
        </div>
        <button class="btn-form-submit">Create Task</button>
      </form>
      <p class="new-task-toggle">
        New Task
        <span><i id="toggle-chevron" class="fas fa-chevron-down"></i></span>
      </p>
    </div>
  </section>
</div>
<script>
  // Show/hide new task from and switch up/down chevron
  document
    .querySelector(".new-task-toggle")
    .addEventListener("click", function () {
      document
        .querySelector(".tasks__new-task-form form")
        .classList.toggle("hidden");
      const toggleIcon = document.querySelector(".fas").classList;
      toggleIcon.toggle("fa-chevron-down");
      toggleIcon.toggle("fa-chevron-up");
    });
</script>
